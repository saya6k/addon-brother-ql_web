#!/command/with-contenv bashio
# ==============================================================================
# Home Assistant Community Add-on: Brother-QL Web
# Runs the webui with Brother-QL Web Python script
# ==============================================================================
bashio::log.info "Starting Brother-QL Web..."

APP_DIR="/app"

# Retrieve configuration values
PRINTER=$(bashio::config 'printer')
MODEL=$(bashio::config 'model')
DEFAULT_LABEL_SIZE=$(bashio::config 'default_label_size')
DEFAULT_ORIENTATION=$(bashio::config 'default_orientation')
LOGLEVEL=$(bashio::config 'log_level')
bashio::log.info "PRINTER=$PRINTER"
bashio::log.info "MODEL=$MODEL"
bashio::log.info "DEFAULT_LABEL_SIZE=$DEFAULT_LABEL_SIZE"
bashio::log.info "DEFAULT_ORIENTATION=$DEFAULT_ORIENTATION"
bashio::log.info "LOGLEVEL=$LOGLEVEL"

# Define additional environment variables
# export GRADIO_ROOT_PATH=$(bashio::addon.ingress_entry)
# bashio::log.info "Serving app from $GRADIO_ROOT_PATH"

# CONFIG_DIR="/config/addons_config/brother-ql_web/"
# mkdir -p /config/addons_config/brother-ql_web/fonts
# chmod -R 775 $FONTS_DIR

# Navigate to application directory and execute the Python script
cd $APP_DIR
exec python3 -u run.py --model $MODEL --default-label-size $DEFAULT_LABEL_SIZE --default-orientation $DEFAULT_ORIENTATION --loglevel $LOGLEVEL $PRINTER